<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<muclient>
<plugin
   name="Horse_Tracker"
   author="Proeliator"
   id="1a51e592868f18f275a46619"
   language="Lua"
   purpose="Track the success/failure of horse usage"
   date_written="2022-11-21 10:05:30"
   save_state="y"
   requires="5.06"
   version="1.1"
   >
</plugin>

<!--  Aliases  -->
<aliases>
  <alias
   script="MyHorseStats"
   match="HorseStats"
   enabled="y"
   ignore_case="y"
   sequence="30"
  >
  </alias>
  <alias
   script="MyHorseStatsReset"
   match="HorseStatsReset"
   enabled="y"
   ignore_case="y"
   sequence="30"
  >
  </alias>
</aliases>
-- Many Many Triggers
<!--  Triggers  -->
<triggers>
  <trigger
   enabled="y"
   keep_evaluating="y"
   match="You mount .+the .+horse."
   omit_from_output="n"
   sequence="18"
   regexp="y"
   script="HorseHandler"
   name="mountsuccess"
  >
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="You try to climb onto .+horse, but .+easily shakes you off and you land with a thump on the ground."
   omit_from_output="n"
   sequence="19"
   regexp="y"
   script="HorseHandler"
   name="mountfail"
  >
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="You .+ horse's pair of brown leather saddlebags."
   omit_from_output="n"
   sequence="20"
   regexp="y"
   script="HorseHandler"
   name="stashsuccess"
  >
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="You try to access .+ horse's saddlebag and promptly get kicked for your trouble."
   omit_from_output="n"
   sequence="21"
   regexp="y"
   script="HorseHandler"
   name="stashfail"
  >
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="You try to convince .+ horse to follow you, but .+ is having none of it."
   omit_from_output="n"
   sequence="22"
   regexp="y"
   script="HorseHandler"
   name="leadfail"
  >
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match=".+ horse starts to follow you."
   omit_from_output="n"
   sequence="23"
   regexp="y"
   script="HorseHandler"
   name="leadsuccess"
  >
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="You dress .+ horse with the"
   omit_from_output="n"
   sequence="23"
   regexp="y"
   script="HorseHandler"
   name="dresssuccess"
  >
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="You try to dress .+ horse with the "
   omit_from_output="n"
   sequence="23"
   regexp="y"
   script="HorseHandler"
   name="dressfail"
  >
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="You approach .+ horse, preparing to groom"
   omit_from_output="n"
   sequence="23"
   regexp="y"
   script="HorseHandler"
   name="groomsuccess"
  >
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="You pick out a brush and have a go at .+ horse's tail with it"
   omit_from_output="n"
   sequence="23"
   regexp="y"
   script="HorseHandler"
   name="groomfail"
  >
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="You mess up the rhythm of your riding and are promptly tossed off .+ horse onto the ground."
   omit_from_output="n"
   sequence="24"
   regexp="y"
   script="HorseHandler"
   name="falloff"
  >
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match=".+ horse seems to get bored of following you and wanders off."
   omit_from_output="n"
   sequence="24"
   regexp="y"
   script="HorseHandler"
   name="wanderoff"
  >
  </trigger>	
	
  <trigger
   enabled="y"
   keep_evaluating="n"
   match="You hunch down over .+ horse and spur .+ into a (\w*) at the"
   omit_from_output="n"
   sequence="25"
   regexp="y"
   script="HorseChargeHandler"
   name="chargesuccess"
  >
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="n"
   match="You hunch down over .+ horse and try to spur .+ into a (\w*) at the"
   omit_from_output="n"
   sequence="26"
   regexp="y"
   script="HorseChargeHandler"
   name="chargefail"
  >
  </trigger>
</triggers>

<script>
<![CDATA[
-- When Plugin is installed, set default values
function OnPluginInstall ()
DefaultValues ()
ColourNote("orange","", "Horse tracker has been installed. Use 'horsestats' to see statistics, 'horsestatsreset' will reset statistics to default values.")
end
-- Reset Horse Statistics
function MyHorseStatsReset ()
DefaultValues ()
ColourNote("orange","", "Horse tracker has been reset")
end
-- Our Default Values
function DefaultValues ()
-- Mount
	imountsuccess = 0
	imountfail = 0
	imountratio = "-"
-- Stash/Retrieve
	istashsuccess = 0
	istashfail = 0
	istashratio = "-"
-- Lead
	ileadsuccess = 0
	ileadfail = 0
	ileadratio = "-"
-- Dress
	idresssuccess = 0
	idressfail = 0
	idressratio = "-"
-- Groom
	igroomsuccess = 0
	igroomfail = 0
	igroomratio = "-"
-- Fall Off
	ifalloff = 0
-- Wander Off
	iwanderoff = 0
-- Charge/Storm at a Walk
	ichargesuccesswalk = 0
	ichargefailwalk = 0
	ichargewalkratio = "-"
-- Charge/Storm at a Trot
	ichargesuccesstrot = 0
	ichargefailtrot = 0
	ichargetrotratio = "-"
-- Charge/Storm at a Canter
	ichargesuccesscanter = 0
	ichargefailcanter = 0
	ichargecanterratio = "-"
-- Charge/Storm at a Gallop
	ichargesuccessgallop = 0
	ichargefailgallop = 0
	ichargegallopratio = "-"
end

-- Function for Horse Handling
function HorseHandler (sName)
	s = string.gsub(sName,"success","")
	s = string.gsub(s,"fail","")

	_G['i' .. sName] = _G['i' .. sName] + 1

	if (string.match(sName, "success") or string.match(sName, "fail")) then
	_G['i' .. s .. 'ratio'] = bc.trunc(( _G['i'..s..'success'] /( _G['i'..s..'success'] + _G['i'..s..'fail'] ))*100)
	end
end

-- Function for Charge/Storm
function HorseChargeHandler (sName, sline, wildcards)
	_G['i'..sName .. wildcards[1]] = _G['i' .. sName .. wildcards[1]] + 1
	_G['icharge' .. wildcards[1] .. 'ratio'] = bc.trunc(( _G['ichargesuccess' .. wildcards[1]] /( _G['ichargesuccess' .. wildcards[1]] + _G['ichargefail' .. wildcards[1]] ))*100)
end

-- Messages sent to the Mud
function MyHorseStats ()
    ColourNote("orange","", "Mount:          Success: " .. tostring(imountsuccess) .. " Fail: ".. tostring(imountfail) .. "     (" .. tostring(imountratio) .. "%)")
    ColourNote("orange","", "Stash/Retrieve: Success: " .. tostring(istashsuccess) .. " Fail: ".. tostring(istashfail) .. "     (" .. tostring(istashratio) .. "%)")
    ColourNote("orange","", "Lead:           Success: " .. tostring(ileadsuccess) .. " Fail: ".. tostring(ileadfail) .. "     (" .. tostring(ileadratio) .. "%)")
    ColourNote("orange","", "Groom:          Success: " .. tostring(igroomsuccess) .. " Fail: ".. tostring(igroomfail) .. "     (" .. tostring(igroomratio) .. "%)")
    ColourNote("orange","", "Dress:          Success: " .. tostring(idresssuccess) .. " Fail: ".. tostring(idressfail) .. "     (" .. tostring(idressratio) .. "%)")
    ColourNote("orange","", "You have fallen off " .. tostring(ifalloff) .. " times")
    ColourNote("orange","", "Your horse has wandered off " .. tostring(iwanderoff) .. " times")
    ColourNote("orange","", "Charge/Storm")
    ColourNote("orange","", "Walk:           Success: " .. tostring(ichargesuccesswalk) .. " Fail: ".. tostring(ichargefailwalk) .. "     (" .. tostring(ichargewalkratio) .. "%)")
    ColourNote("orange","", "Trot:           Success: " .. tostring(ichargesuccesstrot) .. " Fail: ".. tostring(ichargefailtrot) .. "     (" .. tostring(ichargetrotratio) .. "%)")
    ColourNote("orange","", "Canter:         Success: " .. tostring(ichargesuccesscanter) .. " Fail: ".. tostring(ichargefailcanter) .. "     (" .. tostring(ichargecanterratio) .. "%)")
    ColourNote("orange","", "Gallop:         Success: " .. tostring(ichargesuccessgallop) .. " Fail: ".. tostring(ichargefailgallop) .. "     (" .. tostring(ichargegallopratio) .. "%)")
end
]]>
</script> 
</muclient>
